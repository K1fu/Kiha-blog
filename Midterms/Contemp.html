<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction to Computing Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Base Styling (Copied from Study.html) */
        :root {
            /* Calm, Study-Focused Palette */
            --bg-color-light: #f9f9fb; /* Very light, slightly warm gray */
            --text-color-light: #1f2a37; /* Dark charcoal for high contrast */
            --container-bg-light: #ffffff;
            --primary-color-light: #6366f1; /* Deep Indigo/Violet for academic focus */
            --secondary-color-light: #4f46e5; /* Darker Indigo */
            --correct-color: #059669; /* Deep, stable green */
            --incorrect-color: #ef4444; /* Accessible red */
            --border-color-light: #e5e7eb; /* Light separator */
            --shadow-color-light: rgba(17, 24, 39, 0.08); /* Subtle dark shadow */
            --placeholder-color-light: #9ca3af;
            --stage1-color: #3b82f6; /* Blue for Recognize (MCQ) */
            --stage2-color: #f59e0b; /* Amber for Recall (ID) */
            --stage3-color: #10b981; /* Green for Mastery */
        }

        .dark-mode {
            /* Dark Mode for reduced eye strain (Copied from Study.html) */
            --bg-color-light: #1f2a37;
            --text-color-light: #e5e7eb;
            --container-bg-light: #374151;
            --primary-color-light: #60a5fa; 
            --secondary-color-light: #3b82f6;
            --correct-color: #34d399;
            --incorrect-color: #f87171;
            --border-color-light: #4b5563;
            --shadow-color-light: rgba(0, 0, 0, 0.4);
            --placeholder-color-light: #9ca3af;
        }

        /* Screen Shake Animation (Copied from Study.html) */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        /* Subtle Progress Animation (Pulse) (Copied from Study.html) */
        @keyframes pulse-progress {
            0% { box-shadow: 0 0 0 0 var(--correct-color); }
            70% { box-shadow: 0 0 0 5px rgba(5, 150, 105, 0); }
            100% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0); }
        }

        /* Typography and Base Layout (Modified to match Study.html) */
        body {
            /* Using Inter for high readability in body text and general UI elements */
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.4s, color 0.4s;
        }

        .quiz-container {
            width: 100%;
            max-width: 760px; /* Wider container from Study.html */
            margin: 20px;
            padding: 40px 30px; /* Larger padding from Study.html */
            background-color: var(--container-bg-light);
            border-radius: 16px; /* Larger radius from Study.html */
            box-shadow: 0 15px 35px var(--shadow-color-light); /* Deeper shadow from Study.html */
            transition: background-color 0.4s, box-shadow 0.4s;
        }

        /* Header and Mode Toggle (Modified to match Study.html) */
        h1 {
            font-family: 'Poppins', sans-serif; /* Poppins for a distinct, modern header */
            text-align: center;
            color: var(--primary-color-light);
            font-weight: 700;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color-light);
        }

        .theme-toggle, #current-score {
            font-size: 0.9em;
            font-weight: 700;
            color: var(--primary-color-light);
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .theme-toggle {
            cursor: pointer;
            border: 2px solid var(--primary-color-light);
        }

        .theme-toggle:hover {
            background-color: var(--primary-color-light);
            color: white;
            box-shadow: 0 2px 5px rgba(99, 102, 241, 0.3); 
        }

        /* Progress Bar (Modified to match Study.html) */
        .progress-bar-container {
            width: 100%;
            background-color: var(--border-color-light);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 25px;
            height: 18px; 
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--correct-color);
            transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            animation: pulse-progress 2s infinite alternate; 
        }

        #progress-text {
            font-size: 1em;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-color-light);
            text-align: center;
        }
        
        /* Question Grouping for Focus (New for Quiz.html for better styling) */
        .question-group {
            background-color: var(--bg-color-light);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color-light);
        }

        /* Question Area (Modified to match Study.html) */
        #quiz-area {
            min-height: 400px; 
            display: block;
        }

        #question-text {
            font-size: 1.4em; /* Larger text from Study.html */
            margin-bottom: 25px;
            font-weight: 700;
            line-height: 1.6;
            text-align: left;
            color: var(--text-color-light);
        }

        #options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        /* Options/Buttons/Inputs (Modified to match Study.html) */
        .options, #submit-button, #next-button, #restart-button, #start-review-button {
            padding: 18px 25px; 
            border: 2px solid var(--border-color-light);
            background-color: var(--container-bg-light);
            color: var(--text-color-light);
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            text-align: left;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); 
        }
        
        /* Focus Ring for Accessibility (Copied from Study.html) */
        .options:focus, #submit-button:focus, #next-button:focus, #restart-button:focus, #identification-input:focus {
            outline: 3px solid var(--primary-color-light);
            outline-offset: 2px;
        }

        .options:hover:not(.selected):not(.correct):not(.incorrect) {
            background-color: var(--primary-color-light);
            color: white;
            border-color: var(--primary-color-light);
            transform: translateY(-2px); 
            box-shadow: 0 6px 12px rgba(99, 102, 241, 0.2); 
        }

        .options.selected {
            background-color: var(--primary-color-light);
            color: white;
            border-color: var(--primary-color-light);
            transform: scale(1.01);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.4); 
        }

        /* Interactive Cues for Feedback (Copied from Study.html) */
        .options.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.4);
            pointer-events: none;
            position: relative;
        }

        .options.incorrect {
            background-color: var(--incorrect-color);
            color: white;
            border-color: var(--incorrect-color);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
            pointer-events: none;
            position: relative;
        }

        #identification-input {
            width: 100%;
            padding: 18px;
            margin-top: 10px;
            border: 2px solid var(--border-color-light);
            border-radius: 10px;
            font-size: 1em;
            box-sizing: border-box;
            color: var(--text-color-light);
            background-color: var(--container-bg-light);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #identification-input::placeholder {
            color: var(--placeholder-color-light);
            font-weight: 400;
        }

        #submit-button, #next-button {
            display: none; 
            margin-top: 20px;
            text-align: center;
            /* Overriding default styles to ensure text-align: center works */
            text-align: center; 
        }

        #submit-button {
            background-color: var(--correct-color); /* Used correct-color for submit */
            color: white;
            border-color: var(--correct-color);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.3); 
        }

        #submit-button:hover:not(:disabled) {
            background-color: #047857; /* Darker green */
            border-color: #047857;
            box-shadow: 0 6px 12px rgba(5, 150, 105, 0.4); 
        }

        #next-button {
            background-color: var(--primary-color-light);
            color: white;
            border-color: var(--primary-color-light);
        }

        #next-button:hover:not(:disabled) {
            background-color: var(--secondary-color-light);
            border-color: var(--secondary-color-light);
            box-shadow: 0 6px 12px rgba(99, 102, 241, 0.4); 
        }

        /* Feedback Message (Modified to match Study.html) */
        #feedback-message {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
            font-weight: 700;
            min-height: 20px;
            border-radius: 8px;
            font-size: 1.1em;
        }

        .correct-feedback {
            color: var(--correct-color);
            background-color: rgba(5, 150, 105, 0.1);
            border: 1px solid var(--correct-color);
        }

        .incorrect-feedback {
            color: var(--incorrect-color);
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--incorrect-color);
        }
        
        /* End Screen (Modified to match Study.html) */
        #end-screen {
            display: none;
            text-align: center;
        }

        #end-screen h2 {
            font-family: 'Poppins', sans-serif; 
            color: var(--primary-color-light); /* Changed to primary color for general screen */
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        #score-summary {
            background-color: var(--bg-color-light);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color-light);
            text-align: left;
        }

        #score-summary p {
            margin: 10px 0;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
        }

        #score-summary strong {
            font-weight: 700;
            color: var(--primary-color-light);
            font-size: 1.1em;
        }
        
        #score-summary h3 {
             font-family: 'Poppins', sans-serif;
             color: var(--primary-color-light);
             margin-bottom: 15px;
             border-bottom: 2px solid var(--border-color-light);
             padding-bottom: 5px;
        }

        #wrong-answers-list {
            list-style-type: none;
            padding: 0;
            margin-top: 15px;
            text-align: left;
        }

        #wrong-answers-list li {
            background-color: var(--container-bg-light);
            border: 1px solid var(--incorrect-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(231, 76, 60, 0.1);
            font-size: 1em;
            line-height: 1.4;
        }

        #wrong-answers-list li strong {
            color: var(--text-color-light);
        }
        
        #restart-button, #start-review-button {
            margin-top: 25px;
            background-color: var(--primary-color-light);
            color: white;
            border-color: var(--primary-color-light);
        }
        
        #review-summary {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="quiz-container" id="quiz-container">
        <div class="header-controls">
            <span id="current-score">Score: 0</span>
            <span class="theme-toggle" id="theme-toggle">☀️ Light Mode</span>
        </div>

        <h1>Introduction to Computing Quiz</h1>
        
        <div id="quiz-area">
            <div id="progress-text"></div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>

            <div id="feedback-message"></div>
            
            <div class="question-group">
                <p id="question-text"></p>
                
                <div id="options-container">
                    </div>

                <input type="text" id="identification-input" placeholder="Type your answer here..." style="display: none;">
            </div>

            <button id="submit-button">Submit Answer</button>
            <button id="next-button">Next Question</button>
        </div>

        <div id="end-screen">
            <h2>Quiz Complete!</h2>
            
            <div id="score-summary">
                <p>Initial Score: <span id="initial-score-span">0</span> / <span id="initial-total-questions-span">0</span></p>
                <p>Best Score: <strong id="best-score-span">0</strong></p>
                
                <div id="review-summary">
                    </div>

                <h3>Incorrect Answers Review:</h3>
                <ul id="wrong-answers-list">
                    </ul>
            </div>

            <button id="restart-button">Start Over</button>
        </div>

    </div>

    <script>
        // --- Data and State ---
        
        // --- START OF QUIZ DATA ---
        const quizData = {
            multipleChoice: [
                {
                    question: "What is the primary purpose of Asian regionalism?",
                    options: ["To establish a unified Asian military force", "To foster cooperation, integration, and collective decision-making among Asian countries", "To create a single currency for all of Asia", "To isolate Asia from the rest of the world"],
                    answer: "To foster cooperation, integration, and collective decision-making among Asian countries",
                    type: "multipleChoice"
                },
                {
                    question: "Which regional organization was founded in 1967?",
                    options: ["APEC", "SAARC", "ASEAN", "BIMSTEC"],
                    answer: "ASEAN",
                    type: "multipleChoice"
                },
                {
                    question: "What is the economic, social, and political gap between developed and less developed countries called?",
                    options: ["The East-West Divide", "The North-South Divide", "The Urban-Rural Divide", "The Digital Divide"],
                    answer: "The North-South Divide",
                    type: "multipleChoice"
                },
                {
                    question: "Which historical factor is a root cause of the North-South divide?",
                    options: ["The Industrial Revolution", "The Age of Enlightenment", "The Colonial Era", "The Cold War"],
                    answer: "The Colonial Era",
                    type: "multipleChoice"
                },
                {
                    question: "Which country is a founding member of APEC?",
                    options: ["Thailand", "Laos", "Cambodia", "Myanmar"],
                    answer: "Thailand",
                    type: "multipleChoice"
                },
                {
                    question: "Globalization has influenced Asian regionalism by promoting which of the following?",
                    options: ["Isolationism", "Increased trade flows and investment", "Cultural homogeneity", "Decreased digital connectivity"],
                    answer: "Increased trade flows and investment",
                    type: "multipleChoice"
                },
                {
                    question: "What is a negative impact of globalization on poverty?",
                    options: ["It creates new economic opportunities", "It generates jobs and increases incomes", "It can widen income inequalities", "It promotes technological advancements"],
                    answer: "It can widen income inequalities",
                    type: "multipleChoice"
                },
                {
                    question: "The perception that one's own culture is inferior compared to a foreign culture is known as what?",
                    options: ["Racism", "Discrimination", "Colonial Mentality", "Cultural Assimilation"],
                    answer: "Colonial Mentality",
                    type: "multipleChoice"
                },
                {
                    question: "What does the UN's Sustainable Development Goal (SDG) 10 primarily aim to address?",
                    options: ["No Poverty", "Reduced Inequalities", "Climate Action", "Good Health and Well-being"],
                    answer: "Reduced Inequalities",
                    type: "multipleChoice"
                },
                {
                    question: "What is a key impact of globalization on Indigenous Peoples in the Philippines?",
                    options: ["It prevents the exploitation of their natural resources", "It threatens their traditional knowledge and land rights", "It completely isolates them from modern technology", "It eliminates the need for cultural preservation efforts"],
                    answer: "It threatens their traditional knowledge and land rights",
                    type: "multipleChoice"
                },
                {
                    question: "Which organization was founded in 1985?",
                    options: ["BIMSTEC", "SAARC", "APEC", "SASEC"],
                    answer: "SAARC",
                    type: "multipleChoice"
                },
                {
                    question: "The development of complex supply chains across Asia is a result of what?",
                    options: ["Regional conflicts", "Globalization", "Nationalist policies", "Reduced trade"],
                    answer: "Globalization",
                    type: "multipleChoice"
                },
                {
                    question: "What is the economic characteristic of the Global North according to the handout?",
                    options: ["Low per capita income", "Agriculture-focused employment", "Easy access to technological advancement", "Labor-intensive industries"],
                    answer: "Easy access to technological advancement",
                    type: "multipleChoice"
                },
                {
                    question: "Globalization's impact on Sexual Orientation and Gender Identity (SOGI) includes:",
                    options: ["Decreasing awareness and visibility of SOGI issues", "Promoting a uniform legal framework across all of Asia", "Facilitating cultural exchange that challenges traditional norms", "Increasing legal and social stigma"],
                    answer: "Facilitating cultural exchange that challenges traditional norms",
                    type: "multipleChoice"
                },
                {
                    question: "Which regional organization has members from both South Asia and Southeast Asia?",
                    options: ["ASEAN", "BIMSTEC", "SAARC", "SASEC"],
                    answer: "BIMSTEC",
                    type: "multipleChoice"
                },
                {
                    question: "What is a major challenge Latin American economies face due to the global divide?",
                    options: ["An inability to access global markets on equal terms", "An over-reliance on technology-based industries", "A lack of natural resources for export", "An absence of trade barriers"],
                    answer: "An inability to access global markets on equal terms",
                    type: "multipleChoice"
                },
                {
                    question: "Globalization's effect on the Philippines' economic growth is most evident in which sector?",
                    options: ["Agriculture", "Heavy manufacturing", "Business Process Outsourcing (BPO)", "Local crafts and textiles"],
                    answer: "Business Process Outsourcing (BPO)",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is NOT an impact of globalization on Asian regionalism?",
                    options: ["Political dialogue and conflict resolution", "Cultural exchanges", "Increased nationalism and isolation", "Advancement of technological innovation"],
                    answer: "Increased nationalism and isolation",
                    type: "multipleChoice"
                },
                {
                    question: "The North-South divide is rooted in historical factors such as:",
                    options: ["Unequal trade relationships", "The discovery of new continents", "Religious conflicts", "The establishment of democratic governments"],
                    answer: "Unequal trade relationships",
                    type: "multipleChoice"
                },
                {
                    question: "Which country is a member of SAARC?",
                    options: ["Myanmar", "Thailand", "Afghanistan", "Malaysia"],
                    answer: "Afghanistan",
                    type: "multipleChoice"
                },
                {
                    question: "The UN's 2030 Agenda for Sustainable Development includes which of the following goals?",
                    options: ["No Poverty", "Increased Military Spending", "Colonization", "Regional Monopolies"],
                    answer: "No Poverty",
                    type: "multipleChoice"
                },
                {
                    question: "What is a major challenge for Indigenous Peoples (IPs) in the Philippines in the context of globalization?",
                    options: ["The complete removal of cultural biases", "Improved access to all social services", "Environmental degradation of their traditional lands", "Full legal protection of their rights"],
                    answer: "Environmental degradation of their traditional lands",
                    type: "multipleChoice"
                },
                {
                    question: "What is a common economic characteristic of the Global South?",
                    options: ["High per capita income", "Reliance on primary commodities", "Technology-based employment", "Ease of access to capital"],
                    answer: "Reliance on primary commodities",
                    type: "multipleChoice"
                },
                {
                    question: "What does globalization promote in terms of digital connectivity?",
                    options: ["A widening of the urban-rural digital divide", "Less access to information and communication technologies", "Bridging urban-rural divides", "Decreased support for innovation"],
                    answer: "Bridging urban-rural divides",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is a challenge to SOGI rights in Asia due to globalization?",
                    options: ["Conservative backlash to perceived foreign influences", "Increased support networks for SOGI individuals", "The promotion of international human rights norms", "Greater awareness and visibility"],
                    answer: "Conservative backlash to perceived foreign influences",
                    type: "multipleChoice"
                },
                {
                    question: "How does globalization affect Latin America's political influence?",
                    options: ["It grants them equal influence in global forums", "It reduces their ability to advocate for their interests", "It ensures political stability", "It eliminates geopolitical interests"],
                    answer: "It reduces their ability to advocate for their interests",
                    type: "multipleChoice"
                },
                {
                    question: "The economic disparities between the Global North and Global South are illustrated by which of the following?",
                    options: ["Equal per capita income", "Similar levels of technological access", "Higher per capita income in the Global North", "Employment in the same sectors"],
                    answer: "Higher per capita income in the Global North",
                    type: "multipleChoice"
                },
                {
                    question: "Which organization was founded in 1989 to promote sustainable economic growth and prosperity in the Asia-Pacific region?",
                    options: ["ASEAN", "BIMSTEC", "SAARC", "APEC"],
                    answer: "APEC",
                    type: "multipleChoice"
                },
                {
                    question: "What is a positive impact of globalization on Latin American social development?",
                    options: ["It decreases migration to developed regions", "It ensures equal access to healthcare for all", "It has no effect on social services", "It drives migration to more developed regions seeking better opportunities"],
                    answer: "It drives migration to more developed regions seeking better opportunities",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is a characteristic of employment sectors in the Global South?",
                    options: ["Technology-based", "Agriculture-focused", "Finance-focused", "All of the above"],
                    answer: "Agriculture-focused",
                    type: "multipleChoice"
                },
                {
                    question: "What is a negative impact of globalization on the Philippines according to the sources?",
                    options: ["It promotes economic growth", "It has no impact on income distribution", "It concentrates wealth in urban centers", "It creates jobs for everyone"],
                    answer: "It concentrates wealth in urban centers",
                    type: "multipleChoice"
                },
                {
                    question: "Which regional organization was founded in 2001?",
                    options: ["APEC", "SAARC", "SASEC", "BIMSTEC"],
                    answer: "SASEC",
                    type: "multipleChoice"
                },
                {
                    question: "Globalization can lead to what in developing countries due to unequal access to capital and technology?",
                    options: ["Increased competitiveness", "Reinforced existing inequalities", "Reduced poverty", "Complete economic independence"],
                    answer: "Reinforced existing inequalities",
                    type: "multipleChoice"
                },
                {
                    question: "What is the primary purpose of the Bay of Bengal Initiative for Multi-Sectoral Technical and Economic Cooperation (BIMSTEC)?",
                    options: ["To establish a military alliance", "To promote mutual cooperation and economic growth", "To focus solely on cultural exchange", "To create a common currency"],
                    answer: "To promote mutual cooperation and economic growth",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is a social and political gap in the Global South?",
                    options: ["High access to education", "High access to healthcare", "Low political influence in global governance", "High access to basic services"],
                    answer: "Low political influence in global governance",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is an aspect of globalization's impact on Indigenous Peoples in the Philippines?",
                    options: ["Decreased access to education", "The threat to land rights due to economic integration", "The elimination of environmental challenges", "A decrease in cultural diversity"],
                    answer: "The threat to land rights due to economic integration",
                    type: "multipleChoice"
                },
                {
                    question: "Which UN Sustainable Development Goal is paired with 'No Poverty'?",
                    options: ["SDG 1", "SDG 10", "SDG 17", "SDG 5"],
                    answer: "SDG 1",
                    type: "multipleChoice"
                },
                {
                    question: "What is a negative impact of globalization on Latin American social development?",
                    options: ["Decreased income inequality", "Improved access to basic services", "Perpetuation of poverty and social exclusion", "Reduced migration rates"],
                    answer: "Perpetuation of poverty and social exclusion",
                    type: "multipleChoice"
                },
                {
                    question: "Which of the following is a key purpose of the South Asian Association for Regional Cooperation (SAARC)?",
                    options: ["To address climate change only", "To promote cooperation in economic, social, cultural, technical, and scientific fields", "To focus exclusively on military alliances", "To regulate global trade"],
                    answer: "To promote cooperation in economic, social, cultural, technical, and scientific fields",
                    type: "multipleChoice"
                },
                {
                    question: "What does the term 'soft power' refer to in the context of Asian regionalism?",
                    options: ["Military strength and alliances", "Economic sanctions", "Cultural diplomacy and educational exchanges", "Political dominance"],
                    answer: "Cultural diplomacy and educational exchanges",
                    type: "multipleChoice"
                }
            ],
            identification: [
                {
                    question: "The North-South divide is intensified during which historical period?",
                    correctAnswers: ["The Industrial Revolution"],
                    type: "identification"
                },
                {
                    question: "An organization founded in 1967 to accelerate economic growth, social progress, and cultural development in Southeast Asia.",
                    correctAnswers: ["ASEAN"],
                    type: "identification"
                },
                {
                    question: "The economic, social, and political gap between developed and less developed countries.",
                    correctAnswers: ["North-South Divide", "The North-South Divide"],
                    type: "identification"
                },
                {
                    question: "The perception that one's own culture is inferior compared to a foreign culture, a result of historical dominance.",
                    correctAnswers: ["Colonial Mentality"],
                    type: "identification"
                },
                {
                    question: "The process of Asian countries coming together to foster cooperation, integration, and collective decision-making.",
                    correctAnswers: ["Asian Regionalism"],
                    type: "identification"
                },
                {
                    question: "An organization founded in 1989 to promote sustainable economic growth and prosperity in the Asia-Pacific region.",
                    correctAnswers: ["APEC"],
                    type: "identification"
                },
                {
                    question: "A regional organization that includes member states from both South Asia and Southeast Asia.",
                    correctAnswers: ["BIMSTEC"],
                    type: "identification"
                },
                {
                    question: "A form of discrimination based on the belief that race is a fundamental determinant of human traits, with one group being superior.",
                    correctAnswers: ["Racism"],
                    type: "identification"
                },
                {
                    question: "A regional organization founded in 2001 to enhance cross-border connectivity and promote trade.",
                    correctAnswers: ["SASEC"],
                    type: "identification"
                },
                {
                    question: "This is a major challenge for Latin America where a small elite holds a disproportionate share of wealth.",
                    correctAnswers: ["Income Inequality"],
                    type: "identification"
                },
                {
                    question: "This UN Sustainable Development Goal focuses on 'Reduced Inequalities'.",
                    correctAnswers: ["SDG 10", "Goal 10"],
                    type: "identification"
                },
                {
                    question: "This UN Sustainable Development Goal focuses on 'No Poverty'.",
                    correctAnswers: ["SDG 1", "Goal 1"],
                    type: "identification"
                },
                {
                    question: "A regional organization founded in 1985 to promote cooperation in South Asia.",
                    correctAnswers: ["SAARC"],
                    type: "identification"
                }
            ]
        };
        // --- END OF QUIZ DATA ---

        const initialTotalQuestions = quizData.multipleChoice.length + quizData.identification.length;
        let currentFlow = 'main'; // 'main', 'review', or 'finished'
        let currentQuestionIndex = 0; // Index within the current flow's question array
        let mainScore = 0; // Score only for the main quiz attempt
        let answered = false;
        
        // Stores all initial question objects that were answered incorrectly
        // Structure: { question: object, type: string, userAnswer: string }
        let incorrectQuestions = []; 
        
        // Used only during the 'review' flow.
        let reviewQuestions = []; 
        
        // --- DOM Elements ---
        const quizContainer = document.getElementById('quiz-container');
        const quizArea = document.getElementById('quiz-area');
        const endScreen = document.getElementById('end-screen');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const identificationInput = document.getElementById('identification-input');
        const nextButton = document.getElementById('next-button');
        const submitButton = document.getElementById('submit-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const restartButton = document.getElementById('restart-button');
        const initialScoreSpan = document.getElementById('initial-score-span');
        const initialTotalQuestionsSpan = document.getElementById('initial-total-questions-span');
        const bestScoreSpan = document.getElementById('best-score-span');
        const wrongAnswersList = document.getElementById('wrong-answers-list');
        const currentScoreSpan = document.getElementById('current-score');
        const themeToggle = document.getElementById('theme-toggle');
        const reviewSummary = document.getElementById('review-summary');


        // --- Audio and Visual Effects (Web Audio API) (Copied from Study.html) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        /** Plays a quick, high-pitched ding sound for a correct answer. */
        function playCorrectSound() {
            const gainNode = audioCtx.createGain();
            gainNode.connect(audioCtx.destination);
            function playNote(freq, startTime, duration) {
                const osc = audioCtx.createOscillator();
                const noteGain = audioCtx.createGain();
                osc.type = "sine"; 
                osc.frequency.setValueAtTime(freq, startTime);
                osc.connect(noteGain);
                noteGain.connect(gainNode);
                noteGain.gain.setValueAtTime(0.5, startTime);
                noteGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
                osc.start(startTime);
                osc.stop(startTime + duration);
            }
            const now = audioCtx.currentTime;
            playNote(660, now, 0.25); 
            playNote(880, now + 0.1, 0.3);
        }

        /** Plays a short, low-frequency buzz/error sound for an incorrect answer. */
        function playIncorrectSound() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime); 
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
            oscillator.start();
            setTimeout(() => oscillator.stop(), 400);
        }

        /** Applies the CSS shake animation to the quiz container. */
        function shakeScreen() {
            quizContainer.classList.add('shake');
            setTimeout(() => {
                quizContainer.classList.remove('shake');
            }, 500); 
        }

        // --- Utility Functions (Cookies) ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        /**
         * Cleans a string for flexible comparison (used for Identification questions).
         */
        function normalizeAnswer(str) {
            let normalized = str.toLowerCase();
            normalized = normalized.replace(/[^\w\s]/g, ''); // Remove punctuation
            normalized = normalized.replace(/\s/g, '');      // Remove all whitespace
            return normalized;
        }

        // --- Core Quiz Logic ---

        function updateScoreDisplay() {
            // Only display the main score, as the review phase is for mastery, not score
            currentScoreSpan.textContent = `Score: ${mainScore}`;
        }

        function updateProgressBar() {
            let total, current, description;

            if (currentFlow === 'main') {
                total = initialTotalQuestions;
                current = currentQuestionIndex;
                description = `Question ${current + 1} of ${total}`;
                progressBar.style.animation = 'pulse-progress 2s infinite alternate';
            } else if (currentFlow === 'review') {
                total = reviewQuestions.length;
                current = reviewQuestions.length - currentQuestionIndex; // Questions remaining
                // The progress bar should track how many are LEFT to review.
                const percentDone = 100 - ((current / reviewQuestions.length) * 100); 
                
                progressBar.style.width = `${percentDone}%`; // Set width based on percentage done
                progressBar.style.animation = 'pulse-progress 2s infinite alternate';
                progressText.textContent = `Reviewing Mistakes: ${current} Remaining`;
                
                // Exit function here to avoid overwriting width
                return;
                
            } else {
                 // Finished state, show 100% until transition
                total = initialTotalQuestions;
                current = total;
                description = `Quiz Finished!`;
                progressBar.style.animation = 'none';
            }
            
            const progress = (current / total) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = description;
        }
        
        /** Gets the current question object based on the flow and index. */
        function getCurrentQuestion() {
            if (currentFlow === 'main') {
                const mcLength = quizData.multipleChoice.length;
                if (currentQuestionIndex < mcLength) {
                    return quizData.multipleChoice[currentQuestionIndex];
                } else if (currentQuestionIndex < initialTotalQuestions) {
                    const idIndex = currentQuestionIndex - mcLength;
                    return quizData.identification[idIndex];
                }
            } else if (currentFlow === 'review') {
                return reviewQuestions[currentQuestionIndex];
            }
            return null;
        }


        /**
         * Generic check function used by both MC and Identification flows.
         * @param {string} userAnswer - The raw answer provided by the user.
         * @param {string} officialAnswer - The correct answer to display.
         * @param {boolean} isCorrect - Boolean result of the check.
         * @param {object} questionData - The full question object.
         */
        function handleAnswer(userAnswer, officialAnswer, isCorrect, questionData) {
            if (answered) return;
            answered = true;
            nextButton.style.display = 'block';
            submitButton.style.display = 'none';

            if (isCorrect) {
                playCorrectSound();
                feedbackMessage.textContent = "Correct! Well done.";
                feedbackMessage.classList.remove('incorrect-feedback');
                feedbackMessage.classList.add('correct-feedback');

                if (currentFlow === 'main') {
                    mainScore++;
                } else if (currentFlow === 'review') {
                    // Remove the mastered question from the review list
                    reviewQuestions.splice(currentQuestionIndex, 1);
                    // Reset index so the next question is at the start of the now-shorter array
                    currentQuestionIndex = 0; 
                    // Do NOT increment index later
                    return; 
                }
            } else {
                playIncorrectSound();
                shakeScreen();
                feedbackMessage.textContent = `❌ Incorrect. The correct answer was: ${officialAnswer}`;
                feedbackMessage.classList.remove('correct-feedback');
                feedbackMessage.classList.add('incorrect-feedback');

                // Only record incorrect answers during the main flow
                if (currentFlow === 'main') {
                    incorrectQuestions.push({
                        ...questionData,
                        userAnswer: userAnswer,
                        correctAnswer: officialAnswer // Save the official answer for display
                    });
                } else if (currentFlow === 'review') {
                    // In review mode, keep the question in the list, but move it to the end
                    // This is the core "repeat until correct" logic
                    const item = reviewQuestions.splice(currentQuestionIndex, 1)[0];
                    item.userAnswer = userAnswer; // Update the last attempt
                    reviewQuestions.push(item);
                    currentQuestionIndex = 0; // Reset index to the start of the list
                    // Do NOT increment index later
                    return; 
                }
            }
            updateScoreDisplay();
            // Advance index for the main flow or if correct in review (handled in if block)
            currentQuestionIndex++; 
        }

        function selectOption(selectedButton, selectedAnswer) {
            const currentQuestion = getCurrentQuestion();
            const isCorrect = selectedAnswer === currentQuestion.answer;

            // Highlight buttons
            optionsContainer.querySelectorAll('.options').forEach(button => {
                button.disabled = true;
                if (button.textContent === currentQuestion.answer) {
                    button.classList.add('correct');
                }
                if (button === selectedButton && !isCorrect) {
                    button.classList.add('incorrect');
                }
            });

            handleAnswer(selectedAnswer, currentQuestion.answer, isCorrect, currentQuestion);
        }

        function checkIdentificationAnswer() {
            const currentQuestion = getCurrentQuestion();
            const rawInput = identificationInput.value.trim();
            const normalizedInput = normalizeAnswer(rawInput);
            
            identificationInput.disabled = true;

            const isCorrect = currentQuestion.correctAnswers.some(acceptableAnswer => {
                return normalizeAnswer(acceptableAnswer) === normalizedInput;
            });

            const officialAnswer = currentQuestion.correctAnswers[0];

            if (isCorrect) {
                identificationInput.style.borderColor = 'var(--correct-color)';
            } else {
                identificationInput.style.borderColor = 'var(--incorrect-color)';
            }

            handleAnswer(rawInput || "(No answer provided)", officialAnswer, isCorrect, currentQuestion);
        }


        function showQuestion() {
            const currentQuestion = getCurrentQuestion();

            if (!currentQuestion) {
                // If the current flow is finished, transition
                if (currentFlow === 'main') {
                    currentFlow = 'review_prep';
                    prepareReviewScreen();
                } else if (currentFlow === 'review') {
                    currentFlow = 'finished';
                    showFinalEndScreen();
                }
                return;
            }

            answered = false;
            feedbackMessage.textContent = '';
            feedbackMessage.classList.remove('correct-feedback', 'incorrect-feedback');
            identificationInput.style.borderColor = 'var(--border-color-light)';
            identificationInput.disabled = false;
            nextButton.style.display = 'none';

            questionText.textContent = currentQuestion.question;
            updateProgressBar();

            if (currentQuestion.type === 'multipleChoice') {
                // --- Multiple Choice Setup ---
                optionsContainer.style.display = 'flex';
                identificationInput.style.display = 'none';
                submitButton.style.display = 'none';
                optionsContainer.innerHTML = '';
                
                // Shuffle options for cognitive load
                const shuffledOptions = [...currentQuestion.options].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('options');
                    button.textContent = option;
                    button.onclick = () => selectOption(button, option);
                    optionsContainer.appendChild(button);
                });

            } else if (currentQuestion.type === 'identification') {
                // --- Identification Setup ---
                optionsContainer.style.display = 'none';
                identificationInput.style.display = 'block';
                submitButton.style.display = 'block';
                identificationInput.value = ''; // Clear previous input
            }
            
            updateScoreDisplay();
        }

        function prepareReviewScreen() {
            quizArea.style.display = 'none';
            endScreen.style.display = 'block';
            
            // Set initial score summary
            initialScoreSpan.textContent = mainScore;
            initialTotalQuestionsSpan.textContent = initialTotalQuestions;

            // Load best score from cookie
            const currentBestScore = parseInt(getCookie("bestScore") || '0', 10);
            if (mainScore > currentBestScore) {
                setCookie("bestScore", mainScore, 365);
                bestScoreSpan.textContent = mainScore;
            } else {
                bestScoreSpan.textContent = currentBestScore;
            }

            // Display Wrong Answers Summary
            wrongAnswersList.innerHTML = '';
            reviewSummary.innerHTML = '';
            
            if (incorrectQuestions.length > 0) {
                // Set up the review flow
                reviewQuestions = [...incorrectQuestions];
                currentQuestionIndex = 0;
                
                // Show review button
                const reviewButton = document.createElement('button');
                reviewButton.id = 'start-review-button';
                reviewButton.textContent = `Review ${reviewQuestions.length} Mistakes!`;
                reviewButton.addEventListener('click', startReview);
                reviewSummary.appendChild(reviewButton);

                // Populate list of initial wrong answers
                incorrectQuestions.forEach(item => {
                    const li = document.createElement('li');
                    // Get the correct answer string for display. 
                    // MC uses 'answer', ID uses 'correctAnswers[0]'
                    const correctAns = item.answer || item.correctAnswers[0]; 
                    li.innerHTML = `<strong>Q:</strong> ${item.question}<br><strong>Your Answer:</strong> ${item.userAnswer}<br><strong>Correct Answer:</strong> ${correctAns}`;
                    wrongAnswersList.appendChild(li);
                });
                
            } else {
                reviewSummary.innerHTML = "<p class='correct-feedback'>You got all questions right on the first try! 🎉</p>";
                wrongAnswersList.innerHTML = "<li>No mistakes to review!</li>";
            }
        }
        
        function startReview() {
            quizArea.style.display = 'block';
            endScreen.style.display = 'none';
            currentFlow = 'review';
            currentQuestionIndex = 0;
            // The review questions array has already been populated in prepareReviewScreen
            showQuestion();
        }

        function showFinalEndScreen() {
             quizArea.style.display = 'none';
             endScreen.style.display = 'block';
             
             // Check if all mistakes were corrected
             if (reviewQuestions.length === 0) {
                 reviewSummary.innerHTML = "<p class='correct-feedback'>All mistakes have been corrected! Excellent job. 🎉</p>";
                 wrongAnswersList.innerHTML = "<li>You have successfully mastered all challenging questions.</li>";
             } else {
                 reviewSummary.innerHTML = `<p class='incorrect-feedback'>You still have ${reviewQuestions.length} mistake(s) left to master.</p>`;
                 wrongAnswersList.innerHTML = "<li>Review failed: Mistakes remain.</li>"; // A generic message if the user quits review early
             }
             
             updateProgressBar(); // Set progress to 100%
        }

        // --- Event Listeners and Initialization ---

        nextButton.addEventListener('click', () => {
            showQuestion();
        });

        submitButton.addEventListener('click', checkIdentificationAnswer);

        restartButton.addEventListener('click', () => {
            // Reset ALL state variables
            currentFlow = 'main';
            currentQuestionIndex = 0;
            mainScore = 0;
            incorrectQuestions = [];
            reviewQuestions = [];
            
            endScreen.style.display = 'none';
            quizArea.style.display = 'block';
            showQuestion();
        });

        // Theme Toggle Logic
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.textContent = '🌙 Dark Mode';
                setCookie('theme', 'dark', 365);
            } else {
                themeToggle.textContent = '☀️ Light Mode';
                setCookie('theme', 'light', 365);
            }
        });

        // Load theme from cookie and initialize the quiz
        window.onload = () => {
            const savedTheme = getCookie('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.textContent = '🌙 Dark Mode';
            } else {
                document.body.classList.remove('dark-mode');
                themeToggle.textContent = '☀️ Light Mode';
            }
            
            // Initialize score and progress display
            updateScoreDisplay();
            updateProgressBar();
            
            // Start the main quiz
            showQuestion();
        };

    </script>
</body>
</html>