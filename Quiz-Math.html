<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title id="pageTitle">Quiz</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234cc9f0' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2'/%3E%3Cpath d='M7 9h10M7 13h10M7 17h6'/%3E%3Ccircle cx='18' cy='7' r='1' fill='%234cc9f0'/%3E%3C/svg%3E">

<!-- MathJax for mathematical notation -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>

<style>
/* â”€â”€â”€ CYANOTYPE THEME VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --prussian-blue: #002b4d;
  --cobalt-deep: #001a30;
  --cyanotype-white: #e6f3f8;
  --etch-line: rgba(230, 243, 248, 0.2);
  --highlight: #4cc9f0;
  --oxide: #d4af37;
  --sage: #5a9a6a;
  --sage-bg: rgba(90, 154, 106, 0.15);
  --red: #ff6b6b;
  --red-bg: rgba(255, 107, 107, 0.12);
  --blue: #4cc9f0;
  --blue-bg: rgba(76, 201, 240, 0.1);
  --plum: #d4af37;
  --plum-bg: rgba(212, 175, 55, 0.1);
  --transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
  --r: 8px;
  --tr: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

html{scroll-behavior:smooth}

body{
  font-family:'Inter',sans-serif;
  background-color:var(--cobalt-deep);
  color:var(--cyanotype-white);
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
  line-height:1.6;
  overflow-x:hidden;
  display:flex;
  flex-direction:column;
}

/* â”€â”€â”€ CYANOTYPE TEXTURE OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    url("https://www.transparenttextures.com/patterns/carbon-fibre.png"),
    radial-gradient(circle at 50% 50%, transparent 0%, rgba(0, 0, 0, 0.4) 100%);
  opacity: 0.3;
  pointer-events: none;
  z-index: 1;
}

/* â”€â”€â”€ BLUEPRINT GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background-image: 
    linear-gradient(var(--etch-line) 1px, transparent 1px),
    linear-gradient(90deg, var(--etch-line) 1px, transparent 1px);
  background-size: 40px 40px;
  z-index: 0;
  mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
  pointer-events: none;
}

/* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.header{
  background: linear-gradient(135deg, var(--cobalt-deep) 0%, var(--prussian-blue) 100%);
  padding: 36px 20px 30px;
  text-align: center;
  position: relative;
  overflow: hidden;
  border-bottom: 1px solid var(--etch-line);
  z-index: 2;
}

.header::before{
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 70% 60% at 15% 85%, rgba(76, 201, 240, 0.08) 0%, transparent 65%),
              radial-gradient(ellipse 55% 50% at 82% 18%, rgba(76, 201, 240, 0.05) 0%, transparent 65%);
  pointer-events: none;
}

.header h1{
  font-family: 'Inter', sans-serif;
  font-size: clamp(1.7rem, 4.5vw, 2.4rem);
  font-weight: 900;
  color: var(--cyanotype-white);
  position: relative;
  letter-spacing: -0.02em;
  text-transform: uppercase;
}

.header h1 em{
  color: var(--highlight);
  font-style: normal;
  -webkit-text-stroke: 1px var(--highlight);
}

.header p{
  color: rgba(230, 243, 248, 0.6);
  font-size: 0.85rem;
  font-family: 'JetBrains Mono', monospace;
  margin-top: 8px;
  position: relative;
  font-weight: 300;
  letter-spacing: 0.05em;
}

/* â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-wrap{
  position: sticky;
  top: 0;
  z-index: 40;
  background: rgba(0, 26, 48, 0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--etch-line);
  padding: 14px 0 12px;
}

.progress-inner{
  max-width: 680px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 14px;
}

.p-label{
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--cyanotype-white);
  white-space: nowrap;
  min-width: 52px;
  opacity: 0.7;
}

.p-bar{
  flex: 1;
  height: 8px;
  border-radius: 4px;
  background: rgba(230, 243, 248, 0.1);
  overflow: hidden;
  border: 1px solid var(--etch-line);
}

.p-fill{
  height: 100%;
  width: 0%;
  border-radius: 4px;
  background: linear-gradient(90deg, var(--highlight), var(--oxide));
  transition: width 0.45s ease;
  box-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
}

.p-pct{
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--highlight);
  min-width: 42px;
  text-align: right;
}

/* â”€â”€â”€ PHASE TAGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.phase-tag{
  display: inline-block;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  padding: 5px 16px;
  border-radius: 20px;
  margin-bottom: 12px;
  border: 1px solid;
}

.phase-tag.mc   {background: rgba(230, 243, 248, 0.08); color: var(--cyanotype-white); border-color: var(--etch-line)}
.phase-tag.id   {background: rgba(255, 107, 107, 0.1); color: var(--red); border-color: rgba(255, 107, 107, 0.3)}
.phase-tag.tf   {background: rgba(76, 201, 240, 0.1); color: var(--highlight); border-color: rgba(76, 201, 240, 0.3)}
.phase-tag.fitb {background: rgba(212, 175, 55, 0.1); color: var(--oxide); border-color: rgba(212, 175, 55, 0.3)}

/* â”€â”€â”€ QUESTION TYPE FILTER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.modal-overlay.show {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: linear-gradient(135deg, rgba(0, 43, 77, 0.95) 0%, rgba(0, 26, 48, 0.95) 100%);
  border: 1px solid var(--etch-line);
  border-radius: 12px;
  padding: 40px;
  max-width: 500px;
  width: 90%;
  backdrop-filter: blur(10px);
  position: relative;
  animation: slideDown 0.4s cubic-bezier(0.2, 1, 0.3, 1) both;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-content::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 20% 50%, rgba(76, 201, 240, 0.1) 0%, transparent 60%);
  pointer-events: none;
  border-radius: 12px;
}

.modal-header {
  margin-bottom: 28px;
  position: relative;
  z-index: 1;
}

.modal-header h2 {
  font-size: 1.8rem;
  font-weight: 900;
  color: var(--cyanotype-white);
  text-transform: uppercase;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
}

.modal-header h2 em {
  color: var(--highlight);
  font-style: normal;
  -webkit-text-stroke: 1px var(--highlight);
}

.modal-header p {
  color: rgba(230, 243, 248, 0.6);
  font-size: 0.9rem;
  font-family: 'JetBrains Mono', monospace;
  letter-spacing: 0.05em;
}

.modal-body {
  margin-bottom: 28px;
  position: relative;
  z-index: 1;
}

.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  background: rgba(230, 243, 248, 0.04);
  border: 1.5px solid var(--etch-line);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.checkbox-item:hover {
  background: rgba(230, 243, 248, 0.08);
  border-color: var(--highlight);
}

.checkbox-item input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: var(--highlight);
}

.checkbox-label {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.checkbox-label-title {
  font-weight: 600;
  color: var(--cyanotype-white);
  text-transform: uppercase;
  font-size: 0.9rem;
  letter-spacing: 0.05em;
}

.checkbox-label-desc {
  font-size: 0.75rem;
  color: rgba(230, 243, 248, 0.5);
  font-family: 'JetBrains Mono', monospace;
}

.checkbox-item.mc {
  border-left: 3px solid rgba(230, 243, 248, 0.3);
}

.checkbox-item.id {
  border-left: 3px solid var(--red);
}

.checkbox-item.tf {
  border-left: 3px solid var(--highlight);
}

.checkbox-item.fitb {
  border-left: 3px solid var(--oxide);
}

.checkbox-item input:checked + .checkbox-label-title {
  color: var(--highlight);
}

.modal-footer {
  display: flex;
  gap: 12px;
  position: relative;
  z-index: 1;
}

.modal-btn {
  flex: 1;
  padding: 14px 24px;
  font-size: 0.95rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'JetBrains Mono', monospace;
}

.modal-btn-submit {
  background: linear-gradient(135deg, var(--highlight), var(--oxide));
  color: var(--cobalt-deep);
}

.modal-btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
}

.modal-btn-submit:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* â”€â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stage{
  max-width: 680px;
  margin: 40px auto 60px;
  padding: 0 20px;
  min-height: 420px;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  z-index: 2;
}

.card{
  width: 100%;
  background: rgba(0, 43, 77, 0.4);
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  padding: 38px 34px 34px;
  position: relative;
  animation: slideUp 0.38s var(--tr) both;
  backdrop-filter: blur(5px);
}

.card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: 
    linear-gradient(to right, var(--cyanotype-white) 12px, transparent 12px) 0 0,
    linear-gradient(to bottom, var(--cyanotype-white) 12px, transparent 12px) 0 0,
    linear-gradient(to left, var(--cyanotype-white) 12px, transparent 12px) 100% 100%,
    linear-gradient(to top, var(--cyanotype-white) 12px, transparent 12px) 100% 100%;
  background-repeat: no-repeat;
  background-size: 16px 16px;
  opacity: 0.15;
  pointer-events: none;
  border-radius: var(--r);
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(22px)}
  to{opacity:1;transform:translateY(0)}
}

.q-badge{
  position: absolute;
  top: -14px;
  left: 30px;
  background: var(--prussian-blue);
  color: var(--cyanotype-white);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.15em;
  padding: 5px 16px;
  border-radius: 20px;
  text-transform: uppercase;
  border: 1px solid var(--etch-line);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.q-text{
  font-size: 1.15rem;
  line-height: 1.65;
  margin-bottom: 28px;
  color: var(--cyanotype-white);
  font-weight: 400;
}

/* Math styling for MathJax */
.q-text mjx-container,
.opt-text mjx-container,
.feedback mjx-container,
.bd-q mjx-container,
.bd-a mjx-container {
  color: inherit !important;
}

.q-text mjx-container {
  font-size: 1.1em;
}

.opt-text mjx-container {
  font-size: 1.05em;
}

.q-text .math-inline {
  display: inline-block;
  margin: 0 2px;
}

/* â”€â”€â”€ OPTIONS (MC) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.opts{
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.opt{
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  background: rgba(230, 243, 248, 0.05);
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  cursor: pointer;
  transition: var(--tr);
  position: relative;
}

.opt:hover:not(.locked){
  background: rgba(230, 243, 248, 0.09);
  border-color: var(--highlight);
}

.opt.locked{
  cursor: not-allowed;
  opacity: 0.7;
}

.opt.correct{
  background: var(--sage-bg);
  border-color: var(--sage);
}

.opt.wrong{
  background: var(--red-bg);
  border-color: var(--red);
}

.opt.reveal-correct{
  background: var(--sage-bg);
  border-color: var(--sage);
  animation: pulse 0.5s ease;
}

@keyframes pulse{
  0%   {transform: scale(1)}
  50%  {transform: scale(1.02)}
  100% {transform: scale(1)}
}

.opt .icon{
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid var(--etch-line);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  flex-shrink: 0;
  transition: var(--tr);
  font-weight: 700;
}

.opt.correct .icon{
  background: var(--sage);
  border-color: var(--sage);
  color: #fff;
}

.opt.wrong .icon{
  background: var(--red);
  border-color: var(--red);
  color: #fff;
}

.opt.reveal-correct .icon{
  background: var(--sage);
  border-color: var(--sage);
  color: #fff;
}

.opt-text{
  flex: 1;
  font-size: 0.95rem;
  line-height: 1.5;
  color: var(--cyanotype-white);
}

/* â”€â”€â”€ TRUE / FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tf-row{
  display: flex;
  gap: 12px;
}

.tf-btn{
  flex: 1;
  padding: 18px;
  text-align: center;
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  background: rgba(230, 243, 248, 0.05);
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  color: var(--cyanotype-white);
  transition: var(--tr);
}

.tf-btn:hover:not(.locked){
  background: rgba(230, 243, 248, 0.09);
  border-color: var(--highlight);
}

.tf-btn.locked{
  cursor: not-allowed;
  opacity: 0.7;
}

.tf-btn.correct{
  background: var(--sage-bg);
  border-color: var(--sage);
  color: var(--sage);
}

.tf-btn.wrong{
  background: var(--red-bg);
  border-color: var(--red);
  color: var(--red);
}

.tf-btn.reveal-correct{
  background: var(--sage-bg);
  border-color: var(--sage);
  color: var(--sage);
  animation: pulse 0.5s ease;
}

/* â”€â”€â”€ ID / FITB  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.text-wrap{
  position: relative;
}

.text-inp{
  width: 100%;
  padding: 14px 16px;
  font-size: 1rem;
  font-family: 'Inter', sans-serif;
  background: rgba(230, 243, 248, 0.05);
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  color: var(--cyanotype-white);
  transition: var(--tr);
}

.text-inp:focus{
  outline: none;
  border-color: var(--highlight);
  background: rgba(230, 243, 248, 0.08);
}

.text-inp:disabled{
  cursor: not-allowed;
  opacity: 0.6;
}

.text-inp.correct{
  border-color: var(--sage);
  background: var(--sage-bg);
}

.text-inp.wrong{
  border-color: var(--red);
  background: var(--red-bg);
}

.go-btn{
  margin-top: 14px;
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--highlight), var(--oxide));
  color: var(--cobalt-deep);
  font-size: 0.95rem;
  font-weight: 700;
  border: none;
  border-radius: var(--r);
  cursor: pointer;
  transition: var(--tr);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.go-btn:hover:not(:disabled){
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(76, 201, 240, 0.4);
}

.go-btn:disabled{
  cursor: not-allowed;
  opacity: 0.5;
}

/* â”€â”€â”€ FITB PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fitb-preview{
  margin-top: 20px;
  padding: 16px;
  background: rgba(230, 243, 248, 0.03);
  border: 1px dashed var(--etch-line);
  border-radius: var(--r);
  font-size: 0.95rem;
  line-height: 1.6;
  color: rgba(230, 243, 248, 0.7);
}

.fitb-preview .blank{
  display: inline-block;
  min-width: 80px;
  padding: 2px 8px;
  margin: 0 4px;
  background: rgba(76, 201, 240, 0.15);
  border-bottom: 2px solid var(--highlight);
  color: var(--highlight);
  font-weight: 600;
  transition: var(--tr);
}

/* â”€â”€â”€ FEEDBACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.feedback{
  margin-top: 22px;
  padding: 16px 18px;
  border-radius: var(--r);
  font-size: 0.9rem;
  font-weight: 500;
  display: none;
  align-items: center;
  gap: 10px;
}

.feedback.show{
  display: flex;
  animation: slideUp 0.35s var(--tr) both;
}

.feedback.correct{
  background: var(--sage-bg);
  border: 1px solid var(--sage);
  color: var(--sage);
}

.feedback.wrong{
  background: var(--red-bg);
  border: 1px solid var(--red);
  color: var(--red);
}

.feedback span:first-child{
  font-size: 1.2rem;
}

.ans-label{
  font-weight: 700;
  color: var(--cyanotype-white);
}

/* â”€â”€â”€ NAV BUTTON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.nav-btn{
  margin-top: 20px;
  padding: 14px 28px;
  background: linear-gradient(135deg, var(--highlight), var(--oxide));
  color: var(--cobalt-deep);
  font-size: 0.95rem;
  font-weight: 700;
  border: none;
  border-radius: var(--r);
  cursor: pointer;
  transition: var(--tr);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  display: none;
}

.nav-btn.show{
  display: inline-block;
  animation: slideUp 0.4s var(--tr) both;
}

.nav-btn:hover{
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(76, 201, 240, 0.4);
}

/* â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#results{
  display: none;
  max-width: 680px;
  margin: 40px auto;
  padding: 0 20px;
  position: relative;
  z-index: 2;
}

#results.show{
  display: block;
  animation: slideUp 0.5s var(--tr) both;
}

.res-hero{
  background: rgba(0, 43, 77, 0.4);
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  padding: 40px 30px;
  text-align: center;
  backdrop-filter: blur(5px);
  position: relative;
}

.res-hero::after{
  content: "";
  position: absolute;
  inset: 0;
  background: 
    linear-gradient(to right, var(--cyanotype-white) 12px, transparent 12px) 0 0,
    linear-gradient(to bottom, var(--cyanotype-white) 12px, transparent 12px) 0 0,
    linear-gradient(to left, var(--cyanotype-white) 12px, transparent 12px) 100% 100%,
    linear-gradient(to top, var(--cyanotype-white) 12px, transparent 12px) 100% 100%;
  background-repeat: no-repeat;
  background-size: 16px 16px;
  opacity: 0.15;
  pointer-events: none;
  border-radius: var(--r);
}

.res-hero h2{
  font-size: 2rem;
  font-weight: 900;
  color: var(--cyanotype-white);
  margin-bottom: 20px;
  text-transform: uppercase;
  letter-spacing: -0.02em;
}

.res-score{
  font-size: 3.5rem;
  font-weight: 900;
  color: var(--highlight);
  line-height: 1;
  margin-bottom: 8px;
  font-family: 'JetBrains Mono', monospace;
}

.res-sub{
  font-size: 0.85rem;
  color: rgba(230, 243, 248, 0.6);
  font-family: 'JetBrains Mono', monospace;
  margin-bottom: 30px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

.res-grid{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 14px;
  margin-top: 24px;
}

.res-box{
  background: rgba(230, 243, 248, 0.04);
  border: 1px solid var(--etch-line);
  border-radius: var(--r);
  padding: 16px 12px;
  text-align: center;
}

.res-box .v{
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 6px;
}

.res-box .v.gold{
  color: var(--oxide);
}

.res-box .v.g{
  color: var(--sage);
}

.res-box .v.r{
  color: var(--red);
}

.res-box .l{
  font-size: 0.7rem;
  color: rgba(230, 243, 248, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: 600;
}

/* â”€â”€â”€ BREAKDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bd-title{
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--cyanotype-white);
  margin: 32px 0 18px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.bd-item{
  display: grid;
  grid-template-columns: auto auto 1fr auto;
  gap: 14px;
  padding: 14px 16px;
  margin-bottom: 10px;
  background: rgba(255, 107, 107, 0.08);
  border: 1px solid rgba(255, 107, 107, 0.2);
  border-radius: var(--r);
  align-items: center;
  font-size: 0.9rem;
}

.bd-icon{
  font-size: 1.1rem;
}

.bd-num{
  font-family: 'JetBrains Mono', monospace;
  font-weight: 700;
  color: var(--red);
}

.bd-q{
  color: rgba(230, 243, 248, 0.85);
}

.bd-a{
  font-weight: 600;
  color: var(--cyanotype-white);
  text-align: right;
}

.perfect{
  text-align: center;
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--sage);
  margin: 32px 0;
  padding: 24px;
  background: var(--sage-bg);
  border: 1px solid var(--sage);
  border-radius: var(--r);
}

/* â”€â”€â”€ RESULT BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.res-btn-row{
  display: flex;
  gap: 14px;
  justify-content: center;
  margin-top: 28px;
}

.btn{
  padding: 14px 32px;
  font-size: 0.95rem;
  font-weight: 700;
  border: none;
  border-radius: var(--r);
  cursor: pointer;
  transition: var(--tr);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.btn-primary{
  background: linear-gradient(135deg, var(--highlight), var(--oxide));
  color: var(--cobalt-deep);
}

.btn-primary:hover{
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(76, 201, 240, 0.4);
}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 600px){
  .header h1{
    font-size: 1.5rem;
  }
  .res-score{
    font-size: 2.8rem;
  }
  .res-grid{
    grid-template-columns: repeat(2, 1fr);
  }
  .bd-item{
    grid-template-columns: auto 1fr;
    gap: 10px;
  }
  .bd-num{
    grid-column: 1;
  }
  .bd-q{
    grid-column: 2;
  }
  .bd-a{
    grid-column: 1 / -1;
    text-align: left;
    margin-top: 6px;
    padding-top: 8px;
    border-top: 1px solid rgba(255, 107, 107, 0.2);
  }
}

/* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer{
  margin-top: auto;
  padding: 40px 20px;
  background: rgba(0, 43, 77, 0.3);
  border-top: 1px solid var(--etch-line);
  text-align: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: rgba(230, 243, 248, 0.6);
  letter-spacing: 0.05em;
  line-height: 1.8;
  position: relative;
  z-index: 2;
}

.footer::before{
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent 0%, var(--etch-line) 50%, transparent 100%);
}

.footer p{
  margin: 0;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}
</style>
</head>
<body>

<!-- QUESTION TYPE FILTER MODAL -->
<div class="modal-overlay show" id="filterModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Question <em>Filter</em></h2>
      <p>Select which question types you want to receive:</p>
    </div>
    
    <div class="modal-body">
      <div class="checkbox-group">
        <label class="checkbox-item mc">
          <input type="checkbox" class="type-filter" value="mc" checked>
          <div class="checkbox-label">
            <div class="checkbox-label-title">Multiple Choice</div>
            <div class="checkbox-label-desc">Pick the correct option</div>
          </div>
        </label>
        
        <label class="checkbox-item id">
          <input type="checkbox" class="type-filter" value="id" checked>
          <div class="checkbox-label">
            <div class="checkbox-label-title">Identification</div>
            <div class="checkbox-label-desc">Type the answer</div>
          </div>
        </label>
        
        <label class="checkbox-item tf">
          <input type="checkbox" class="type-filter" value="tf" checked>
          <div class="checkbox-label">
            <div class="checkbox-label-title">True or False</div>
            <div class="checkbox-label-desc">Choose true or false</div>
          </div>
        </label>
        
        <label class="checkbox-item fitb">
          <input type="checkbox" class="type-filter" value="fitb" checked>
          <div class="checkbox-label">
            <div class="checkbox-label-title">Fill in the Blank</div>
            <div class="checkbox-label-desc">Complete the sentence</div>
          </div>
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="modal-btn modal-btn-submit" onclick="applyFilter()">Start Quiz</button>
    </div>
  </div>
</div>

<!-- HEADER -->
<div class="header">
  <h1><em>Math</em> Quiz</h1>
  <p>Now with Mathematical Notation Support</p>
</div>

<!-- PROGRESS BAR -->
<div class="progress-wrap">
  <div class="progress-inner">
    <div class="p-label" id="pLabel">1 / 5</div>
    <div class="p-bar"><div class="p-fill" id="pFill"></div></div>
    <div class="p-pct" id="pPct">0%</div>
  </div>
</div>

<!-- STAGE -->
<div class="stage">
  <div id="cardWrap"></div>
  <button class="nav-btn" id="navBtn" onclick="advance()"></button>
</div>

<!-- RESULTS -->
<div id="results"></div>

<!-- FOOTER -->
<footer class="footer">
  <p>This website is for educational and review purposes only. The developer shall not be held liable for any forms of cheating done by the user.</p>
</footer>

<script>
// load questions based on URL param (e.g. ?mode=MMW or ?mode=Calculus)

const params = new URLSearchParams(window.location.search);
const mode = params.get("mode");

console.log("=== QUIZ LOADER DEBUG ===");
console.log("Current URL:", window.location.href);
console.log("Parsed mode parameter:", mode);

// Map of modes to their respective JS file paths
const modeMap = {
  "MMW": "Courses/1st year/2ndsemester/Prelims/MMW.js",
  "Calculus": "Courses/1st year/2ndsemester/Prelims/Calculus.js",
  "Discrete": "Courses/1st year/2ndsemester/Prelims/Discrete.js"
};

// Map of modes to their display titles
const titleMap = {
  "MMW": "Mathematics in the Modern World",
  "Calculus": "Calculus",
  "Discrete": "Discrete Mathematics"
};

console.log("Available modes:", Object.keys(modeMap));

// Set page title and header based on mode
if (mode && titleMap[mode]) {
  const displayTitle = titleMap[mode];
  document.getElementById('pageTitle').textContent = displayTitle + ' Quiz';
  // Update the header title - find the em tag and update it
  const headerEm = document.querySelector('.header h1 em');
  if (headerEm) {
    headerEm.textContent = displayTitle.split(' ')[0];
  }
  const headerP = document.querySelector('.header p');
  if (headerP) {
    headerP.textContent = 'Answer each question â€” the correct answer is revealed right away';
  }
}

// Load the appropriate script file based on the mode parameter
console.log("Current URL:", window.location.href);
console.log("Mode parameter:", mode);
console.log("Mode map:", modeMap);
console.log("modeMap[mode]:", mode && modeMap[mode]);

if (mode && modeMap[mode]) {
  const script = document.createElement("script");
  script.src = modeMap[mode];
  console.log("Loading script from:", script.src);
  
  script.onload = function() {
    console.log("âœ“ Script loaded successfully!");
    console.log("QUESTIONS array type:", typeof QUESTIONS);
    console.log("QUESTIONS length:", QUESTIONS ? QUESTIONS.length : "undefined");
    initializeConfig();
    console.log("TOTAL set to:", TOTAL);
    
    // Try to restore saved progress
    if (loadProgress()) {
      console.log("âœ“ Resumed quiz from saved progress");
    } else {
      console.log("âœ“ Starting fresh quiz");
    }
    
    // Trigger MathJax to render if available
    if (window.MathJax && window.MathJax.typesetPromise) {
      console.log("Rendering MathJax...");
      MathJax.typesetPromise().catch(err => console.log('MathJax render error:', err));
    }
    
    render();
  };
  
  script.onerror = function(error) {
    console.error("âœ— Failed to load script:", script.src);
    console.error("Error details:", error);
  };
  
  console.log("Appending script to head...");
  document.head.appendChild(script);
} else {
  console.warn("âœ— No valid mode or mode not in modeMap");
  console.warn("Mode:", mode);
  console.warn("Available modes:", Object.keys(modeMap));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAMPLE QUESTIONS WITH MATH NOTATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   To use math in questions or answers, wrap expressions in:
   - $...$ for inline math (e.g., $x^2 + y^2$)
   - $$...$$ for display math (centered equations)
   
   Examples of LaTeX math:
   - Fractions: $\\frac{a}{b}$
   - Exponents: $x^2$ or $e^{2x}$
   - Square roots: $\\sqrt{x}$ or $\\sqrt[3]{x}$
   - Greek letters: $\\alpha$, $\\beta$, $\\pi$, $\\theta$
   - Subscripts: $x_1$, $x_{12}$
   - Sums: $\\sum_{i=1}^{n} i$
   - Integrals: $\\int_0^1 x^2 dx$
   - Complex: $\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$
   
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let current = 0;
let score   = 0;
let wrongs  = [];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG  (will be initialized after QUESTIONS loads)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let TOTAL;
const TYPE_LABELS = {mc:'Multiple Choice', id:'Identification', tf:'True/False', fitb:'Fill Blank'};

// Store filtered questions
let QUESTIONS_FILTERED = [];

function initializeConfig() {
  TOTAL = QUESTIONS.length;
  QUESTIONS_FILTERED = QUESTIONS;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION TYPE FILTER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyFilter() {
  // Get selected checkboxes
  const checkboxes = document.querySelectorAll('.type-filter:checked');
  const selectedTypes = Array.from(checkboxes).map(cb => cb.value);
  
  // Validate at least one type is selected
  if (selectedTypes.length === 0) {
    alert('Please select at least one question type!');
    return;
  }
  
  // Filter questions based on selected types
  QUESTIONS_FILTERED = QUESTIONS.filter(q => selectedTypes.includes(q.type));
  
  // Update TOTAL and reset progress
  TOTAL = QUESTIONS_FILTERED.length;
  current = 0;
  score = 0;
  wrongs = [];
  
  // Hide modal and start quiz
  document.getElementById('filterModal').classList.remove('show');
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COOKIES - Save/Load Progress
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setCookie(name, value, days = 7) {
  const date = new Date();
  date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
  const expires = "expires=" + date.toUTCString();
  document.cookie = name + "=" + encodeURIComponent(JSON.stringify(value)) + ";" + expires + ";path=/";
}

function getCookie(name) {
  const nameEQ = name + "=";
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    cookie = cookie.trim();
    if (cookie.indexOf(nameEQ) === 0) {
      try {
        return JSON.parse(decodeURIComponent(cookie.substring(nameEQ.length)));
      } catch(e) {
        return null;
      }
    }
  }
  return null;
}

function deleteQuizCookie() {
  document.cookie = "quizProgress=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
}

function saveProgress() {
  const progressData = {
    mode: mode,
    current: current,
    score: score,
    wrongs: wrongs,
    timestamp: new Date().toISOString()
  };
  setCookie('quizProgress', progressData);
}

function loadProgress() {
  const saved = getCookie('quizProgress');
  if (saved && saved.mode === mode) {
    current = saved.current || 0;
    score = saved.score || 0;
    wrongs = saved.wrongs || [];
    console.log("Progress restored:", { current, score, wrongs });
    return true;
  }
  return false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN RENDER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render(){
  if(current >= TOTAL){
    showResults();
    return;
  }

  const item = QUESTIONS_FILTERED[current];
  let html = '';

  /* Question Badge + Text */
  html += `<div class="q-badge">Question ${current+1}</div>`;
  html += `<div class="phase-tag ${item.type}">${TYPE_LABELS[item.type]}</div>`;
  html += `<div class="q-text">${item.q}</div>`;

  /* Type-Specific UI */
  if(item.type === 'mc'){
    html += '<div class="opts">';
    item.o.forEach((opt, i) => {
      html += `<div class="opt" id="opt-${i}" onclick="pickMC(${i})">
                 <div class="icon"></div>
                 <div class="opt-text">${opt}</div>
               </div>`;
    });
    html += '</div>';
  }
  else if(item.type === 'tf'){
    html += `<div class="tf-row">
               <div class="tf-btn" id="tf-true" onclick="pickTF(true)">True</div>
               <div class="tf-btn" id="tf-false" onclick="pickTF(false)">False</div>
             </div>`;
  }
  else if(item.type === 'id' || item.type === 'fitb'){
    if(item.type === 'fitb'){
      html += `<div class="fitb-preview">
                 ${item.before} <span class="blank" id="fitbPreview">___</span> ${item.after}
               </div>`;
    }
    html += `<div class="text-wrap">
               <input type="text" class="text-inp" id="textInput" placeholder="Type your answer..." 
                      ${item.type === 'fitb' ? 'oninput="updateBlank()"' : ''} />
               <button class="go-btn" id="goBtn" onclick="submitText()">Submit Answer</button>
             </div>`;
  }

  html += '<div class="feedback" id="feedback"></div>';

  document.getElementById('cardWrap').innerHTML = `<div class="card">${html}</div>`;
  document.getElementById('navBtn').classList.remove('show');
  document.getElementById('results').classList.remove('show');
  
  updateProgress();
  
  // Typeset math after rendering
  if(window.MathJax && window.MathJax.typesetPromise){
    MathJax.typesetPromise().catch((err) => console.log('MathJax error:', err));
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HANDLERS â€“ one per type
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Multiple Choice â”€â”€ */
function pickMC(chosen){
  document.querySelectorAll('.opt').forEach(o => o.classList.add('locked'));
  const item    = QUESTIONS_FILTERED[current];
  const correct = item.a;
  const isRight = chosen === correct;

  if(isRight){
    score++;
    playCorrectSound();
  }
  else{
    wrongs.push({ num: current+1, q: item.q, ans: item.o[correct] });
    playIncorrectSound();
  }

  document.getElementById('opt-'+chosen).classList.add(isRight ? 'correct' : 'wrong');
  document.getElementById('opt-'+chosen).querySelector('.icon').textContent = isRight ? 'âœ“' : 'âœ—';

  if(!isRight){
    document.getElementById('opt-'+correct).classList.add('reveal-correct');
    document.getElementById('opt-'+correct).querySelector('.icon').textContent = 'âœ“';
  }
  showFeedback(isRight, item.o[correct]);
  saveProgress();
  revealNav();
}

/* â”€â”€ True / False â”€â”€ */
function pickTF(chosen){
  document.getElementById('tf-true').classList.add('locked');
  document.getElementById('tf-false').classList.add('locked');

  const item    = QUESTIONS_FILTERED[current];
  const isRight = chosen === item.a;
  const correctId = item.a ? 'tf-true' : 'tf-false';
  const chosenId  = chosen ? 'tf-true' : 'tf-false';

  if(isRight){
    score++;
    playCorrectSound();
  } 
  else{
    wrongs.push({ num: current+1, q: item.q, ans: item.a ? 'True' : 'False' });
    playIncorrectSound();
  }

  document.getElementById(chosenId).classList.add(isRight ? 'correct' : 'wrong');

  if(!isRight) document.getElementById(correctId).classList.add('reveal-correct');

  showFeedback(isRight, item.a ? 'True' : 'False');
  saveProgress();
  revealNav();
}

/* â”€â”€ Identification + Fill-in-the-Blank (shared) â”€â”€ */
function submitText(){
  const inp   = document.getElementById('textInput');
  const goBtn = document.getElementById('goBtn');
  const val   = inp.value.trim();
  if(!val) return;

  inp.disabled   = true;
  goBtn.disabled = true;

  const item    = QUESTIONS_FILTERED[current];
  const isRight = norm(val) === norm(item.a);

  if(isRight) {
    score++;
    playCorrectSound();
  } else {
    wrongs.push({ num: current+1, q: item.type === 'fitb' ? (item.before + ' ___ ' + item.after) : item.q, ans: item.a });
    playIncorrectSound();
  }

  inp.classList.add(isRight ? 'correct' : 'wrong');

  /* update live preview for FITB */
  if(item.type === 'fitb'){
    const preview = document.getElementById('fitbPreview');
    if(isRight){
      preview.style.color = 'var(--sage)';
    } else {
      // overwrite the blank with the correct answer so the sentence reads right
      preview.textContent = item.a;
      preview.style.color = 'var(--sage)';
    }
  }

  showFeedback(isRight, item.a);
  saveProgress();
  revealNav();
}

/* â”€â”€ FITB Live Preview â”€â”€ */
function updateBlank(){
  const item = QUESTIONS_FILTERED[current];
  if(item.type !== 'fitb') return;
  const val = document.getElementById('textInput').value.trim();
  document.getElementById('fitbPreview').textContent = val || '___';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED UI HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Music functions */
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playCorrectSound() {
  const gainNode = audioCtx.createGain();
  gainNode.connect(audioCtx.destination);
  
  function playNote(freq, startTime, duration, waveType = "square") {
    const osc = audioCtx.createOscillator();
    const noteGain = audioCtx.createGain();
    osc.type = waveType;
    osc.frequency.setValueAtTime(freq, startTime);
    osc.connect(noteGain);
    noteGain.connect(gainNode);
    noteGain.gain.setValueAtTime(0.3, startTime);
    noteGain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
    osc.start(startTime);
    osc.stop(startTime + duration);
  }
  
  const now = audioCtx.currentTime;
  playNote(880, now, 0.15, "square");
  playNote(1046, now + 0.12, 0.15, "square");
  playNote(1318, now + 0.24, 0.2, "square");
}

function playIncorrectSound() {
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  oscillator.type = 'sawtooth';
  oscillator.frequency.setValueAtTime(450, audioCtx.currentTime);
  oscillator.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.4);
  
  gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
  
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + 0.4);
}

/* show feedback message */
function showFeedback(isRight, correctAns){
  const fb = document.getElementById('feedback');
  fb.className = 'feedback show ' + (isRight ? 'correct' : 'wrong');
  fb.innerHTML = isRight
    ? '<span>âœ“</span> <span class="ans-label">Correct!</span> Great job.'
    : '<span>âœ—</span> The correct answer is: <span class="ans-label">' + correctAns + '</span>';
  
  // Typeset math in feedback
  if(window.MathJax && window.MathJax.typesetPromise){
    MathJax.typesetPromise([fb]).catch((err) => console.log('MathJax error:', err));
  }
}

function revealNav(){
  const btn = document.getElementById('navBtn');
  btn.classList.add('show');
  btn.textContent = current < TOTAL-1 ? 'Next Question â†’' : 'See Results';
}

function advance(){
  current++;
  saveProgress();
  render();
  window.scrollTo({ top:0, behavior:'smooth' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateProgress(){
  const pct = Math.round((current / TOTAL) * 100);
  document.getElementById('pLabel').textContent = (current+1) + ' / ' + TOTAL;
  document.getElementById('pFill').style.width  = pct + '%';
  document.getElementById('pPct').textContent   = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResults(){
  document.getElementById('cardWrap').innerHTML = '';
  document.getElementById('pLabel').textContent = TOTAL + ' / ' + TOTAL;
  document.getElementById('pFill').style.width  = '100%';
  document.getElementById('pPct').textContent   = '100%';

  const pct = Math.round((score / TOTAL) * 100);

  /* per-type counts */
  const types = ['mc','id','tf','fitb'];
  let statBoxes = `<div class="res-box"><div class="v gold">${pct}%</div><div class="l">Score</div></div>`;
  types.forEach(t => {
    const total   = QUESTIONS.filter(q => q.type === t).length;
    if(!total) return;
    const missed  = wrongs.filter((w,i) => {
      return w.num && QUESTIONS[w.num-1] && QUESTIONS[w.num-1].type === t;
    }).length;
    const correct = total - missed;
    statBoxes += `<div class="res-box"><div class="v g">${correct}/${total}</div><div class="l">${TYPE_LABELS[t]}</div></div>`;
  });
  statBoxes += `<div class="res-box"><div class="v r">${wrongs.length}</div><div class="l">Missed</div></div>`;

  /* missed-items breakdown */
  let bdHtml = '';
  if(wrongs.length){
    bdHtml += '<div class="bd-title">Items Missed</div>';
    wrongs.forEach(w => {
      bdHtml +=
        `<div class="bd-item">
           <span class="bd-icon">âŒ</span>
           <span class="bd-num">#${w.num}</span>
           <span class="bd-q">${w.q}</span>
           <span class="bd-a">${w.ans}</span>
         </div>`;
    });
  } else {
    bdHtml = '<div class="perfect">ğŸ‰ Perfect score â€” outstanding work!</div>';
  }

  document.getElementById('results').innerHTML =
    `<div class="res-hero">
       <h2>Quiz Complete</h2>
       <div class="res-score">${score} / ${TOTAL}</div>
       <div class="res-sub">Total Score</div>
       <div class="res-grid">${statBoxes}</div>
     </div>
     ${bdHtml}
     <div class="res-btn-row">
       <button class="btn btn-primary" onclick="restart()">Retake Quiz</button>
     </div>`;

  document.getElementById('results').classList.add('show');
  
  // Typeset math in results
  if(window.MathJax && window.MathJax.typesetPromise){
    MathJax.typesetPromise().catch((err) => console.log('MathJax error:', err));
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESTART  |  UTIL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function restart(){ 
  current=0; 
  score=0; 
  wrongs=[]; 
  deleteQuizCookie();
  render(); 
  window.scrollTo({top:0,behavior:'smooth'}); 
}
function norm(s){ return s.toLowerCase().replace(/[^a-z0-9]/g,''); }

/* â”€â”€ INIT â”€â”€ */
// render() is called from the script loading callback after QUESTIONS is loaded

</script>
</body>
</html>